{% block content %}
{% load static %}


<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <title>C7 Motors</title>
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta content="" name="keywords">
        <meta content="" name="description">

        <!-- Google Web Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,400;0,700;0,900;1,400;1,700;1,900&family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Poppins:200,300,400,500,600,700,800,900" rel="stylesheet"> 

        <!-- Icon Font Stylesheet -->
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"/>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">
        <link rel="icon" type="image/png" href="{% static 'img/c7_logo.png'%}">

        <!-- Libraries Stylesheet -->
        <link href="{% static 'lib/animate/animate.min.css'%}" rel="stylesheet">
        <link href="{% static 'lib/owlcarousel/assets/owl.carousel.min.css'%}" rel="stylesheet">


        <!-- Customized Bootstrap Stylesheet -->
        <link href="{% static 'css/bootstrap.min.css'%}" rel="stylesheet">

        <!-- Template Stylesheet -->
        <link href="{% static 'css/style.css'%}" rel="stylesheet">
        <link rel="stylesheet" href="{% static 'css/owl.carousel.min.css '%}">
        <link rel="stylesheet" href="{% static 'css/owl.theme.default.min.css '%}">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/4.5.6/css/ionicons.min.css">
		<link rel="stylesheet" href="{% static 'css/animate.css'%}">
		<link rel="stylesheet" href="{% static 'css/style4.css'%}">

        <!-- Styling -->
        <style>
            /* card responsive styling */
            @media (max-width: 576px) {
                .card {
                    margin-top: 20px;
                }
            } 
            
            /* descrption styling */
            .desc-section { 
                padding-left: 0%;
                padding-right: 0%;
                padding-top: 0%;
                padding-bottom: 7em;
            }

            .work .img {
                width: 100%;
                height: 100%;
                position: relative;
                z-index: 0;
                border-radius: 10px;
                overflow: hidden;
                -webkit-box-shadow: 0px 20px 35px -30px rgba(0, 0, 0, 0.26);
                -moz-box-shadow: 0px 20px 35px -30px rgba(0, 0, 0, 0.26);
                box-shadow: 0px 20px 35px -30px rgba(0, 0, 0, 0.26);
            }   

            .carousel-prev,
            .carousel-next {
                background: rgba(0, 0, 0, 0.6);
                color: white;
                border: none;
                border-radius: 50%;
                width: 30px;
                height: 30px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 26px;
                cursor: pointer;
                position: absolute;
                top: 50%;
                transform: translateY(-50%);
                z-index: 10;
                pointer-events: auto;
                transition: background 0.3s;
            }

            .carousel-prev:hover,
            .carousel-next:hover {
                background: rgba(0, 0, 0, 0.9);
            }

            .carousel-prev {
                left: 20px;
            }

            .carousel-next {
                right: 20px;
            }
        </style>
    </head>

    <body>

        <!-- Spinner Start -->
        <div id="spinner" class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
            <div class="spinner-border" style="width: 3rem; height: 3rem;color:#e30a23" role="status">
                <span class="sr-only">Loading...</span>
            </div>
        </div>
        <!-- Spinner End -->

        <!-- Topbar Start -->
        <div class="container-fluid topbar d-none d-xl-block w-100" style="background:#ffffff;">
            <div class="container">
                <div class="row gx-0 align-items-center" style="height: 45px;">
                    <div class="col-lg-6 text-center text-lg-start mb-lg-0">
                        <div class="d-flex flex-wrap">
                            <a class="text-muted me-4"><i class="fas fa-phone-alt me-2" style="color: #e30a23;"></i>+971562341000</a>
                            <a class="text-muted me-0"><i class="fas fa-envelope me-2" style="color: #e30a23;"></i>Csev7motors@gmail.com</a>
                        </div>
                    </div>
                    <div class="col-lg-6 text-center text-lg-end">
                        <div class="d-flex align-items-center justify-content-end">
                            <a href="https://www.tiktok.com/@_c7motors" class="btn btn-light btn-sm-square rounded-circle me-3"><i class="fab fa-tiktok"></i></a>
                            <a href="https://www.instagram.com/c.7.motors/" class="btn btn-light btn-sm-square rounded-circle me-3"><i class="fab fa-instagram"></i></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Topbar End -->

        <!-- Navbar & Hero Start -->
        <div class="container-fluid nav-bar sticky-top px-0 px-lg-4 py-2 py-lg-0">
            <div class="container">
                <nav class="navbar navbar-expand-lg navbar-light">
                    <a href="" class="navbar-logo p-0">
                        <img src="{% static 'img/c7_logo.png'%}" alt="">
                    </a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
                        <span class="fa fa-bars"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarCollapse">
                        <div class="navbar-nav mx-auto py-0">
                            <a href="{% url 'c7_motors:home' %}" class="nav-item nav-link"><i class="bi bi-house-door"></i> Home</a>
                            <a href="{% url 'c7_motors:about' %}" class="nav-item nav-link"><i class="bi bi-info-circle"></i> About</a>
                            <a href="{% url 'c7_motors:service' %}" class="nav-item nav-link"><i class="bi bi-tools"></i> Service</a>
                            <a href="{% url 'c7_motors:feature' %}" class="nav-item nav-link"><i class="bi bi-star-fill"></i> Features</a>
                            <a href="{% url 'c7_motors:shopping_cart' %}" class="nav-item nav-link"><i class="bi bi-basket3"></i> My Cart</a>
                            <a class="nav-item nav-link" id="checkout-button" data-bs-toggle="modal" data-bs-target="#exampleModal" type="button"><i class="bi bi-cash"></i> Pay</a>
                            <a href="{% url 'c7_motors:contact_us' %}" class="nav-item nav-link"><i class="bi bi-telephone"></i> Contact</a>
                        </div>
                        {% if user.is_authenticated %}
                        <form action="/log_out/" method="post" class="main_nav">
                         {% csrf_token %}
                         <a class="btn rounded-pill py-2 px-4" style="background-color: #e30a23;"><button type="submit" class="btn" style="color: #ffffff;">Log out</button></a>
                        </form>
                        {% else %}
                        <a class="btn rounded-pill py-2 px-4" style="background-color: #e30a23;" href="{% url 'c7_motors:log_in'%}"><button type="submit" class="btn" style="color: #ffffff;">Log in</button></a>
                        <a class="btn rounded-pill py-2 px-4" style="background-color: #e30a23;" href="{% url 'c7_motors:sign_in'%}" style="margin-left: 20px;"><button type="submit" class="btn" style="color: #ffffff;">Sign in</button></a>
                        {% endif %}
                    </div>
                </nav>
            </div>
        </div>
        <!-- Navbar & Hero End -->

        <!-- Model Start -->
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                <h1 class="modal-title" id="exampleModalLabel" style="color: #e30a23;">Welcome to<h1 class="modal-title" style="color: #323232;margin-left:5px">C</h1> <h1 class="modal-title" style="color: #e30a23;">7</h1></h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Please wait until return to checkout page
                </div>
            </div>
            </div>
        </div>
        <!-- Model End -->

        <!-- Car Images Slider and Details Start -->
        <section class="ftco-section">
            <div class="container">
                <div class="row">
                    <!-- Images Slider -->
                    <div class="col-lg-7 col-md-12 order-1 order-lg-1">
                        <div class="slider-hero position-relative">
                            <div class="featured-carousel owl-carousel">
                                {% for image in car_images %}
                                <div class="item">
                                    <div class="work">
                                        <img src="{{ image.image.url }}" class="img d-flex align-items-center justify-content-center">
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                            <!-- Navigation Arrows -->
                            <button class="carousel-prev">&lt;</button>
                            <button class="carousel-next">&gt;</button>
                        </div>
                    </div>
                    
        
                    <!-- Card Section -->
                    <div class="col-lg-5 col-md-12 order-2 order-lg-2 d-flex justify-content-center align-items-center">
                        <div class="card" style="width: 100%; max-width: 20rem;">
                            <div class="card-body">
                                <h5 class="card-title">{{ car.brand_name }} {{ car.model }}</h5>
                            </div>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">{{ car.model_year }}</li>
                                <li class="list-group-item">Mileage : {{ car.mileage }} Km</li>
                                <li class="list-group-item">Exterior Color : {{ car.exterior_color }}</li>
                                <li class="list-group-item">Interior Color : {{ car.interior_color }}</li>
                                <li class="list-group-item">Transmission : {{ car.transmission }}</li>
                                <li class="list-group-item">Price : {{ car.cash_price }} AED</li>
                                <li class="list-group-item">Installment Price: {{ car.monthly_installments_price }} AED</li>
                            </ul>
                            <div class="card-body">
                                <button class="btn w-100 py-2 add" style="background-color: #e30a23; color:rgb(38, 33, 33);" type="button" value="{{ car.id }}">Add To Cart</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>  
        <section class="desc-section">
            <div class="container">
                <div class="row">
                    <!-- Images Slider -->
                    <div class="col-lg-7 col-md-12 order-1 order-lg-1">  
                        <div class="rounded" id="description-container">
                            {% for line in description_lines %}
                            <p class="mb-2" style="font-size: 25px;">
                                <i class="fa fa-check-circle me-1" style="color: #e30a23;"></i>
                                {{ line }}
                            </p>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </section>    
        <!-- Car Images Slider and Details End -->

        <!-- Footer Start -->
        <div class="container-fluid footer py-5 wow fadeIn" data-wow-delay="0.2s">
            <div class="container py-5">
                <div class="row g-5">
                    <div class="col-md-6 col-lg-6 col-xl-3">
                        <div class="footer-item d-flex flex-column">
                            <div class="footer-item">
                                <h4 class="text-white mb-4">About Us</h4>
                                <p class="mb-3">
                                    At C7 Motors, we are dedicated to making car ownership accessible and seamless. Our mission is to provide high-quality, pre-owned vehicles paired with exceptional customer service.
                                    We offer flexible payment options, including cash purchases and convenient installment plans, ensuring that everyone can find the right car for their needs. 
                                    At C7 Motors, our goal is to help you drive away with confidence and satisfaction.
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-6 col-xl-3">
                        <div class="footer-item d-flex flex-column">
                            <h4 class="text-white mb-4">Quick Links</h4>
                            <a href="{% url 'c7_motors:about' %}"><i class="fas fa-angle-right me-2"></i> About</a>
                            <a href="{% url 'c7_motors:shopping_cart' %}"><i class="fas fa-angle-right me-2"></i> My Cart</a>
                            <a href="{% url 'c7_motors:contact_us' %}"><i class="fas fa-angle-right me-2"></i> Contact us</a>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-6 col-xl-3">
                        <div class="footer-item d-flex flex-column">
                            <h4 class="text-white mb-4">Business Hours</h4>
                            <div class="mb-3">
                                <h6 class="text-muted mb-0">We are open to serve you from 10:00 AM to 10:00 PM every day</h6>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-6 col-xl-3">
                        <div class="footer-item d-flex flex-column">
                            <h4 class="text-white mb-4">Contact Info</h4>
                            <a href="#"><i class="fa fa-map-marker-alt me-2"></i> 18th St -Al Quoz Industrial Area 1 - Dubai - United Arab Emirates</a>
                            <a><i class="fas fa-envelope me-2"></i> Csev7motors@gmail.com</a>
                            <a><i class="fas fa-phone me-2"></i> +971562341000</a>
                            <div class="d-flex">
                                <a class="btn btn-md-square rounded-circle me-3" href="https://www.tiktok.com/@_c7motors"><i class="fab fa-tiktok text-white"></i></a>
                                <a class="btn btn-md-square rounded-circle me-3" href="https://www.instagram.com/c.7.motors/"><i class="fab fa-instagram text-white"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Footer End -->
        
        <!-- Copyright Start -->
        <div class="container-fluid copyright py-4">
            <div class="container">
                <div class="row g-4 align-items-center">
                    <div class="col-md-6 text-center text-md-start mb-md-0">
                        <span class="text-body"><a href="#" class="border-bottom text-white"><i class="fas fa-copyright text-light me-2"></i>C7 Motors</a>, All right reserved.</span>
                    </div>'
                    <div class="col-md-6 text-center text-md-start mb-md-0">
                        <span class="text-body"><a href="#" class="border-bottom text-white">Designed & Developed By Sana Salhdar</a> +963968678579</span>
                    </div>
                </div>
            </div>
        </div>
        <!-- Copyright End -->


        <!-- Back to Top -->
        <a href="#" class="btn btn-lg-square rounded-circle back-to-top" style="background-color: black; color:#e30a23"><i class="fa fa-arrow-up"></i></a>   

        
    <!-- JavaScript Libraries -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'lib/wow/wow.min.js'%}"></script>
    <script src="{% static 'lib/easing/easing.min.js'%}"></script>
    <script src="{% static 'lib/waypoints/waypoints.min.js'%}"></script>
    <script src="{% static 'lib/counterup/counterup.min.js'%}"></script>
    <script src="{% static 'lib/owlcarousel/owl.carousel.min.js'%}"></script>
    <script>
        //protect the site by cookie
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        const csrftoken = getCookie('csrftoken');


        // add cars to cart
        let btns = document.querySelectorAll('.add')
        btns.forEach(btn => {
          btn.addEventListener('click' , addToCart)
        })
        function addToCart(e){
            let car_id = e.target.value
            let url = "/add_to_cart/"
            let data = {id:car_id} 

            fetch(url ,{
            method : "POST",
            headers : {"Comtent-Type" : "application/json" , "X-CSRFToken" : csrftoken} ,
            body : JSON.stringify(data)
        })
        .then(res => res.json()) 
        .then(data => {
            console.log(data)
        })
        .catch(error =>{
            console.log(error)
        })
        function goToManage() {
            // Replace 'https://example.com/another-page' with the actual URL of the target page
            setTimeout(function() {
                window.location.href = 'https://c7motors-cracgggsbcchenap.uaenorth-01.azurewebsites.net/shopping_cart';
            }, 400);
        }
        goToManage();
        }

        (function ($) {
            "use strict";
        
            var owl = $('.featured-carousel');
        
            // Initialize Owl Carousel
            owl.owlCarousel({
                animateOut: 'fadeOut',
                center: false,
                items: 1,
                loop: true,
                stagePadding: 0,
                margin: 0,
                smartSpeed: 1500,
                autoplay: false,
                dots: false,
                nav: false
            });
        
            // Add event listeners to the custom navigation buttons
            $('.carousel-prev').click(function () {
                owl.trigger('prev.owl.carousel');
            });
        
            $('.carousel-next').click(function () {
                owl.trigger('next.owl.carousel');
            });
        })(jQuery);
    </script>
    
    <!-- Checkout Stripe -->
    <script src="https://js.stripe.com/v3/"></script>
    <script type="text/javascript">
        // Initialize Stripe with the publishable key passed from Django
        var stripe = Stripe('{{ STRIPE_PUBLISHABLE_KEY }}');  
    
        // Assign total_price from the Django template to a JavaScript variable
        var remainingPrice = "{{ stripe_remaining }}";  // This will be output as a string
    
        // Convert the string to a number (in case it's a decimal or string)
        var remainingPriceFloat = parseFloat(remainingPrice);
    
        // Make sure the checkout button is clicked before starting the Stripe process
        var checkoutButton = document.getElementById('checkout-button');
    
        checkoutButton.addEventListener('click', function() {
            // Send a POST request to create the checkout session
            fetch('/create-remaining-checkout-session/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}',  // Include CSRF token for security
                },
                body: JSON.stringify({
                    stripe_remaining: remainingPriceFloat  // Pass the correctly parsed total price as a number
                }),
            })
            .then(function(response) {
                return response.json();
            })
            .then(function(session) {
                // Redirect to the Stripe Checkout session
                return stripe.redirectToCheckout({ sessionId: session.id });
            })
            .then(function(result) {
                if (result.error) {
                    // If there's an error, alert the user
                    alert(result.error.message);
                }
            })
            .catch(function(error) {
                console.error('Error:', error);
            });
        });
    </script>

    <!-- Template Javascript -->
    <script src="{% static 'js/main1.js'%}"></script>
    <script src="{% static 'js/jquery.min.js' %}"></script>
    <script src="{% static 'js/popper.js' %}"></script>
    <script src="{% static 'js/bootstrap.min.js'%}"></script>
    <script src="{% static 'js/owl.carousel.min.js'%}"></script>
    </body>

</html>


{% endblock %}